import{d as M,r as m,a as z,c as O,o as g,b as P,e as x,w as D,v as E,u,n as S,f as y,F as W,g as $,h as B,i as G,j as I,k as X}from"./index-413f07bc.js";const k=M("ctx",()=>{const v=m(!0),p=z({mode:"line",color:"#000000",lineWidth:1});return{isGrid:v,ctx:p,updateIsGrid:()=>v.value=!v.value,updateCtx:(e,i)=>{p[e]=i}}}),_=k();function Y(){class v{constructor(t){this.canvas=t,this.ctx=t.value.getContext("2d"),this.pathStore=[],this.type="stroke",this.path=new Path2D,this.contextOptions=null}init(t){this.startPoint=t,this.lastPoint=t,this.ctx.moveTo(t.x,t.y)}line(t,n){this.ctx.beginPath(),this.path=new Path2D,this.path.moveTo(this.lastPoint.x,this.lastPoint.y),this.path.lineTo(t,n),this.type="stroke",this.draw(),this.ctx.closePath(),this.lastPoint={x:t,y:n}}arc(t,n){this.path=new Path2D;const e=t-this.startPoint.x,i=n-this.startPoint.y,s=this.startPoint.x+e/2,o=this.startPoint.y+i/2,c=Math.pow(e*e+i*i,1/2);this.path.arc(s,o,c/2,0,Math.PI*2),this.type="stroke",this.draw()}rect(t,n){this.path=new Path2D;const e=t-this.startPoint.x,i=n-this.startPoint.y;this.path.rect(this.startPoint.x,this.startPoint.y,e,i),this.type="stroke",this.draw()}getMarkSize(t){const n=t/4;switch(!0){case t<100:return{w:1,h:n<2?2:n,incline:2,size:n<2?2:n/2};default:return{w:4,h:20,incline:4,size:10}}}mark(t,n){this.ctx.save(),this.path=new Path2D;const e=t-this.startPoint.x,i=n-this.startPoint.y,s=e<0?-1:1,o=Math.pow(e*e+i*i,1/2)*s;let c=Math.asin(Math.sin(i/o));this.setContextOptions({translate:{x:this.startPoint.x,y:this.startPoint.y},rotate:c});const l=this.getMarkSize(Math.abs(o));this.path.lineTo(0,0),this.path.lineTo(0,-l.w/2),this.path.lineTo(o-l.h*s,-l.size),this.path.lineTo(o-l.h*s-l.incline*s,-l.size*2),this.path.lineTo(o,0),this.path.lineTo(o-l.h*s-l.incline*s,l.size*2),this.path.lineTo(o-l.h*s,l.size),this.path.lineTo(0,l.w/2),this.path.lineTo(0,0),this.type="fill",this.draw(),this.ctx.restore()}text(t,n,e){const s=document.createElement("textarea");s.cols=1,s.rows=1,this.setContextOptions({font:"32px auto",textBaseline:"middle"}),s.oninput=o=>{this.clearCanvas(),this.reDraw(),s.cols=o.target.value.length+1,this.ctx.fillText(o.target.value,t+2,n)},s.onblur=o=>{this.type="fill",this.path={x:t+2,y:n,text:o.target.value},o.target.value&&this.savePath(),s.parentNode.removeChild(s)},s.style.cssText=`
        overflow: hidden;
        position: absolute;
        top: ${n-32/2}px;
        left: ${t}px;
        height: 32px;
        line-height: 32px;
        background-color: transparent;
        outline: none;
        resize: none;
        border: 1px solid #000;
        font-size: 32px;
        white-space: pre-wrap;
        text-indent: 2px;
        color: transparent;
        caret-color: #000;
      `,e.value.appendChild(s)}reDraw(){this.pathStore.forEach(({type:t,contextOptions:n,path:e})=>{e.text?this.ctx.fillText(e.text,e.x,e.y):(this.type=t,this.contextOptions=n,this.path=e,this.draw(!0)),this.contextOptions=null})}clear(t,n){this.ctx.save(),this.path=new Path2D,this.setContextOptions({lineWidth:20,lineCap:"round",globalCompositeOperation:"destination-out"}),this.path.moveTo(this.lastPoint.x,this.lastPoint.y),this.path.lineTo(t,n),this.type="stroke",this.draw(),this.lastPoint={x:t,y:n},this.ctx.restore()}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.value.width,this.canvas.value.height)}setContextOptions(t){for(let n in t){if(n==="translate"){this.ctx[n](t[n].x,t[n].y);continue}if(n==="rotate"){this.ctx[n](t[n]);continue}this.ctx[n]=t[n]}this.contextOptions={...this.contextOptions,...t}}draw(t){this.ctx.save(),this.ctx.beginPath(),t?this.setContextOptions(this.contextOptions):this.setContextOptions({strokeStyle:_.ctx.color,fillStyle:_.ctx.color,lineWidth:_.ctx.lineWidth}),this.type==="stroke"?this.ctx.stroke(this.path):this.ctx.fill(this.path),this.ctx.closePath(),this.ctx.restore()}savePath(){this.pathStore.push({type:this.type,contextOptions:this.contextOptions||{},path:this.path}),this.contextOptions=null,this.type="stroke"}}return{Draw:v}}const j=["max"],R={class:"item"},U=["onClick"],V={__name:"actionBar",props:{handleDownload:{type:Function,required:!0}},setup(v){const p=v,t=k(),n=m(!1),e=m(null),i=m(50),s=z([{icon:"icon-juxing1",type:"rect"},{icon:"icon-yuanxingweixuanzhong",type:"arc"},{icon:"icon-jiantou_youshang",type:"mark"},{icon:"icon-Icon_huabi",type:"line"},{icon:"icon-wenzi",type:"text"},{icon:"icon-chexiao",type:"revoke"},{icon:"icon-chexiao",type:"forward"},{icon:"icon-rubber-full",type:"clear"},{icon:"icon-xiazai-",type:"download"}]),o=O(()=>e.value?getComputedStyle(e.value).height:0),c=(l,a)=>{if(a==="download")return p.handleDownload();t.updateCtx(l,a)};return(l,a)=>(g(),P("aside",null,[x("div",{class:y(["tabbar",{collapsed:n.value}]),ref_key:"tabbar",ref:e},[D(x("input",{class:"line-width",type:"range","onUpdate:modelValue":a[0]||(a[0]=r=>u(t).ctx.lineWidth=r),max:i.value,style:S({width:o.value,"background-image":`linear-gradient(to right, #91caff ${u(t).ctx.lineWidth/i.value*100+"%"}, transparent ${u(t).ctx.lineWidth/100*100+"%"})`}),onChange:a[1]||(a[1]=r=>c("lineWidth",r.target.value))},null,44,j),[[E,u(t).ctx.lineWidth]]),x("div",{class:y(["item iconfont icon-wangge",{"hide-grid":!u(t).isGrid}]),onClick:a[2]||(a[2]=(...r)=>u(t).updateIsGrid&&u(t).updateIsGrid(...r))},null,2),x("div",R,[D(x("input",{class:"color",type:"color","onUpdate:modelValue":a[3]||(a[3]=r=>u(t).ctx.color=r),onChange:a[4]||(a[4]=r=>c("color",r.target.value))},null,544),[[E,u(t).ctx.color]])]),(g(!0),P(W,null,$(s,r=>(g(),P("div",{class:y(["item iconfont",[r.icon,u(t).ctx.mode===r.type?"active":""]]),key:r.type,onClick:B(w=>c("mode",r.type),["stop"])},null,10,U))),128))],2),x("div",{class:y(["collapsed-btn iconfont icon-jiantou_yemian_xiangzuo_o",{overturn:n.value}]),onClick:a[5]||(a[5]=r=>n.value=!n.value)},null,2)]))}};const A={__name:"drawingBoard",setup(v){const p=k(),{Draw:t}=Y(),n=m(),e=m();let i=null,s=0;const o=()=>{const{clientWidth:h,clientHeight:d}=document.documentElement;e.value.width=h,e.value.height=d,i.reDraw()},c=m(!1),l=()=>{const h=e.value.toDataURL(),d=document.createElement("a");d.setAttribute("href",h),d.setAttribute("download",Math.random().toString(16).slice(-6)),d.click()},a=h=>{c.value=!0,s=new Date().getTime();const{clientX:d,clientY:f}=h;i.init({x:d,y:f}),p.ctx.mode==="text"&&(c.value=!1,i.text(d,f,n))},r=h=>{if(!c.value)return;const{clientX:d,clientY:f}=h;i.clearCanvas(),["line","clear"].includes(p.ctx.mode)&&i.savePath(),i.reDraw(),i[p.ctx.mode](d,f)},w=()=>{c.value=!1,new Date().getTime()-s>200&&i.savePath(),s=0},C=h=>a(h.changedTouches[0]),T=h=>r(h.changedTouches[0]),b=w,L=()=>{e.value.addEventListener("mousedown",a),e.value.addEventListener("mousemove",r),e.value.addEventListener("onmouseleave",w),e.value.addEventListener("mouseup",w),e.value.addEventListener("touchstart",C),e.value.addEventListener("touchmove",T),e.value.addEventListener("touchend",b)};return G(()=>{i=new t(e),o(),L(),window.addEventListener("resize",o)}),I(()=>{e.value.removeEventListener("mousedown",a),e.value.removeEventListener("mousemove",r),e.value.removeEventListener("onmouseleave",w),e.value.removeEventListener("mouseup",w),e.value.removeEventListener("touchstart",C),e.value.removeEventListener("touchmove",T),e.value.removeEventListener("touchend",b),window.removeEventListener("resize",o)}),(h,d)=>(g(),P("main",{ref_key:"canvasRoot",ref:n},[x("canvas",{ref_key:"cDom",ref:e,class:y(["canvas",{"show-grid":u(p).isGrid}])},null,2),X(V,{handleDownload:l})],512))}};export{A as default};
