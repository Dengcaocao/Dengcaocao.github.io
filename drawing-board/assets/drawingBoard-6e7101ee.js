import{d as k,r as m,o as v,c as f,F as M,a as S,n as b,u as D,w as z,b as w,e as C,f as O,g as E}from"./index-1a96bc82.js";const _=k("ctx",()=>{const d=m({mode:"line"});return{ctx:d,handleCtx:t=>d.mode=t}});function B(){class d{constructor(t){this.canvas=t,this.ctx=t.value.getContext("2d"),this.pathStore=[],this.type="stroke",this.path=new Path2D,this.styleOptions=null}init(t){this.startPoint=t,this.lastPoint=t,this.ctx.moveTo(t.x,t.y)}line(t,e){this.path=new Path2D,this.path.moveTo(this.lastPoint.x,this.lastPoint.y),this.path.lineTo(t,e),this.type="stroke",this.draw(),this.lastPoint={x:t,y:e}}arc(t,e){this.path=new Path2D;const i=Math.abs(t-this.startPoint.x),s=Math.abs(e-this.startPoint.y),n=Math.pow(i*i+s*s,1/2);this.path.arc(this.startPoint.x,this.startPoint.y,n,0,Math.PI*2),this.type="stroke",this.draw()}rect(t,e){this.path=new Path2D;const i=t-this.startPoint.x,s=e-this.startPoint.y;this.path.rect(this.startPoint.x,this.startPoint.y,i,s),this.type="stroke",this.draw()}getMarkSize(t){const e=t/4;switch(!0){case t<100:return{w:1,h:e<2?2:e,incline:2,size:e<2?2:e/2};default:return{w:4,h:20,incline:4,size:10}}}mark(t,e){this.path=new Path2D,this.ctx.save();const i=t-this.startPoint.x,s=e-this.startPoint.y,n=i<0?-1:1,a=Math.pow(i*i+s*s,1/2)*n;let c=Math.asin(Math.sin(s/a));const u={translate:{x:this.startPoint.x,y:this.startPoint.y},rotate:c,fillStyle:"red"};this.setStyle(u);const o=this.getMarkSize(Math.abs(a));this.path.lineTo(0,0),this.path.lineTo(0,-o.w/2),this.path.lineTo(a-o.h*n,-o.size),this.path.lineTo(a-o.h*n-o.incline*n,-o.size*2),this.path.lineTo(a,0),this.path.lineTo(a-o.h*n-o.incline*n,o.size*2),this.path.lineTo(a-o.h*n,o.size),this.path.lineTo(0,o.w/2),this.path.lineTo(0,0),this.type="fill",this.draw(),this.ctx.restore()}text(t,e,i){const n=document.createElement("textarea");n.cols=1,n.rows=1;const a={font:"32px auto",textBaseline:"middle"};this.setStyle(a),n.oninput=c=>{this.clearCanvas(),this.pathStore.forEach(({type:u,styleOptions:o,path:l})=>{l.text?this.ctx.fillText(l.text,l.x,l.y):(this.type=u,this.styleOptions=o,this.path=l,this.draw(!0))}),n.cols=c.target.value.length+1,this.ctx.fillText(c.target.value,t+2,e)},n.onblur=c=>{this.type="fill",this.path={x:t+2,y:e,text:c.target.value},c.target.value&&this.savePath(),n.parentNode.removeChild(n)},n.style.cssText=`
        overflow: hidden;
        position: absolute;
        top: ${e-32/2}px;
        left: ${t}px;
        height: 32px;
        line-height: 32px;
        background-color: transparent;
        outline: none;
        resize: none;
        border: 1px solid #000;
        font-size: 32px;
        white-space: pre-wrap;
        text-indent: 2px;
        color: transparent;
        caret-color: #000;
      `,i.value.appendChild(n)}clear(t,e){this.path=new Path2D,this.ctx.save();const i={lineWidth:20,lineCap:"round",globalCompositeOperation:"destination-out"};this.setStyle(i),this.path.moveTo(this.lastPoint.x,this.lastPoint.y),this.path.lineTo(t,e),this.type="stroke",this.draw(),this.lastPoint={x:t,y:e},this.ctx.restore()}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.value.width,this.canvas.value.height)}setStyle(t){for(let e in t){if(e==="translate"){this.ctx[e](t[e].x,t[e].y);continue}if(e==="rotate"){this.ctx[e](t[e]);continue}this.ctx[e]=t[e]}this.styleOptions=t}draw(t){this.ctx.save(),this.ctx.beginPath(),t&&this.setStyle(this.styleOptions),this.type==="stroke"?this.ctx.stroke(this.path):this.ctx.fill(this.path),this.ctx.closePath(),this.ctx.restore()}savePath(){this.pathStore.push({type:this.type,styleOptions:this.styleOptions||{},path:this.path}),this.styleOptions=null,this.type="stroke"}}return{Draw:d}}const $={class:"aside"},L=["onClick"],X={__name:"actionBar",props:{handleDownload:{type:Function,required:!0}},setup(d){const p=d,t=_(),e=m([{icon:"icon-juxing1",type:"rect"},{icon:"icon-yuanxingweixuanzhong",type:"arc"},{icon:"icon-jiantou_youshang",type:"mark"},{icon:"icon-Icon_huabi",type:"line"},{icon:"icon-wenzi",type:"text"},{icon:"icon-rubber-full",type:"clear"},{icon:"icon-xiazai-",type:"download"}]),i=s=>{s==="download"&&p.handleDownload(),t.handleCtx(s)};return(s,n)=>(v(),f("aside",$,[(v(!0),f(M,null,S(e,a=>(v(),f("div",{class:b(["item iconfont",[a.icon,D(t).ctx.mode===a.type?"active":""]]),key:a.type,onClick:z(c=>i(a.type),["stop"])},null,10,L))),128))]))}};const j={__name:"drawingBoard",setup(d){const p=_(),{Draw:t}=B(),e=w(),i=w();let s=null;const n=()=>{const{clientWidth:r,clientHeight:h}=document.documentElement;i.value.width=r,i.value.height=h},a=w(!1),c=()=>{const r=i.value.toDataURL(),h=document.createElement("a");h.setAttribute("href",r),h.setAttribute("download",Math.random().toString(16).slice(-6)),h.click()},u=r=>{a.value=!0;const{clientX:h,clientY:y}=r;s.init({x:h,y}),p.ctx.mode==="text"&&(a.value=!1,s.text(h,y,e))},o=r=>{if(!a.value)return;const{clientX:h,clientY:y}=r;s.clearCanvas(),["line","clear"].includes(p.ctx.mode)&&s.savePath(),s.pathStore.forEach(({type:P,styleOptions:T,path:x})=>{x.text?s.ctx.fillText(x.text,x.x,x.y):(s.type=P,s.styleOptions=T,s.path=x,s.draw(!0))}),s[p.ctx.mode](h,y)},l=()=>{a.value=!1,s.savePath()},g=()=>{i.value.addEventListener("mousedown",u),i.value.addEventListener("mousemove",o),i.value.addEventListener("onmouseleave",l),i.value.addEventListener("mouseup",l)};return C(()=>{n(),g(),s=new t(i)}),(r,h)=>(v(),f("main",{ref_key:"canvasRoot",ref:e},[O("canvas",{ref_key:"cDom",ref:i,class:"canvas"},null,512),E(X,{handleDownload:c})],512))}};export{j as default};
