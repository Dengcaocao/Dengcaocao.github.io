import{d as $,r as g,o as x,c as _,F as D,a as S,n as L,u as X,b as h,e as Y,f as j,g as A}from"./index-dbb2640b.js";const f=$("ctx",()=>{const v=g({mode:"line"});return{ctx:v,handleCtx:u=>v.mode=u}});const F={class:"aside"},N=["onClick"],I={__name:"actionBar",props:{handleDownload:{type:Function,required:!0}},setup(v){const r=v,u=f(),l=g([{icon:"icon-juxing1",type:"rect"},{icon:"icon-yuanxingweixuanzhong",type:"arc"},{icon:"icon-jiantou_youshang",type:"mark"},{icon:"icon-Icon_huabi",type:"line"},{icon:"icon-wenzi",type:"text"},{icon:"icon-rubber-full",type:"clear"},{icon:"icon-xiazai-",type:"download"}]),e=d=>{d==="download"&&r.handleDownload(),u.handleCtx(d)};return(d,p)=>(x(),_("aside",F,[(x(!0),_(D,null,S(l,o=>(x(),_("div",{class:L(["item iconfont",[o.icon,X(u).ctx.mode===o.type?"active":""]]),key:o.type,onClick:m=>e(o.type)},null,10,N))),128))]))}};const W={__name:"drawingBoard",setup(v){const r=f(),u=h(),l=h(),e=h(),d=()=>{const{clientWidth:a,clientHeight:t}=document.documentElement;l.value.width=a,l.value.height=t,e.value=l.value.getContext("2d")},p=h(!1),o=h({x:0,y:0}),m=(a,t)=>{e.value.lineTo(a,t),e.value.stroke()},y=(a,t)=>{e.value.clearRect(0,0,l.value.width,l.value.height);const c=Math.abs(a-o.value.x),n=Math.abs(t-o.value.y),s=Math.pow(c*c+n*n,1/2);e.value.beginPath(),e.value.arc(o.value.x,o.value.y,s,0,Math.PI*2),e.value.closePath(),e.value.stroke()},b=(a,t)=>{e.value.clearRect(0,0,l.value.width,l.value.height);const c=a-o.value.x,n=t-o.value.y;e.value.beginPath(),e.value.strokeRect(o.value.x,o.value.y,c,n),e.value.closePath()},T=a=>{const t=a/4;switch(!0){case a<100:return{w:1,h:t<2?2:t,incline:2,size:t<2?2:t/2};default:return{w:4,h:20,incline:4,size:10}}},k=(a,t)=>{e.value.clearRect(0,0,l.value.width,l.value.height),e.value.save();const c=a-o.value.x,n=t-o.value.y,s=Math.pow(c*c+n*n,1/2)*(c<0?-1:1);let R=Math.asin(Math.sin(n/s));e.value.translate(o.value.x,o.value.y),e.value.rotate(R),e.value.beginPath();const i=T(Math.abs(s));e.value.lineTo(0,0),e.value.lineTo(0,-i.w/2),e.value.lineTo(s-i.h,-i.size),e.value.lineTo(s-i.h-i.incline,-i.size*2),e.value.lineTo(s,0),e.value.lineTo(s-i.h-i.incline,i.size*2),e.value.lineTo(s-i.h,i.size),e.value.lineTo(0,i.w/2),e.value.lineTo(0,0),e.value.fillStyle="red",e.value.fill(),e.value.closePath(),e.value.restore()},M=(a,t)=>{const n=document.createElement("textarea");n.cols=1,n.rows=1,n.oninput=s=>{n.cols=s.target.value.length+1,e.value.save(),e.value.beginPath(),e.value.font="32px auto",e.value.textBaseline="middle",e.value.fillText(s.target.value,a+2,t),e.value.closePath(),e.value.restore()},n.onblur=()=>n.parentNode.removeChild(n),n.style.cssText=`
    overflow: hidden;
    position: absolute;
    top: ${t-32/2}px;
    left: ${a}px;
    height: 32px;
    line-height: 32px;
    background-color: transparent;
    outline: none;
    resize: none;
    border: 1px solid #000;
    font-size: 32px;
    white-space: pre-wrap;
    text-indent: 2px;
    color: transparent;
    caret-color: #000;
  `,u.value.appendChild(n)},z=()=>{const a=l.value.toDataURL(),t=document.createElement("a");t.setAttribute("href",a),t.setAttribute("download",Math.random().toString(16).slice(-6)),t.click()},C=(a,t)=>{e.value.save(),e.value.beginPath(),e.value.lineWidth=20,e.value.lineCap="round",e.value.globalCompositeOperation="destination-out",e.value.lineTo(a,t),e.value.stroke(),e.value.closePath(),e.value.restore()},P=a=>{p.value=!0;const{clientX:t,clientY:c}=a;o.value={x:t,y:c},e.value.moveTo(t,c),r.ctx.mode==="text"&&M(t,c)},B=a=>{if(!p.value||r.ctx.mode==="text")return;const{clientX:t,clientY:c}=a;({line:m,arc:y,rect:b,mark:k,clear:C})[r.ctx.mode](t,c)},w=()=>p.value=!1,E=()=>{l.value.addEventListener("mousedown",P),l.value.addEventListener("mousemove",B),l.value.addEventListener("onmouseleave",w),l.value.addEventListener("mouseup",w)};return Y(()=>{d(),E()}),(a,t)=>(x(),_("main",{ref_key:"canvasRoot",ref:u},[j("canvas",{ref_key:"cDom",ref:l,class:"canvas"},null,512),A(I,{handleDownload:z})],512))}};export{W as default};
