import{d as M,r as x,a as z,c as b,o as f,b as g,w as C,v as T,u as c,e as w,n as S,f as _,F as L,g as W,h as $,i as B,j as G,k as I}from"./index-98276880.js";const k=M("ctx",()=>{const u=x(!0),h=z({mode:"line",color:"#000000",lineWidth:1});return{isGrid:u,ctx:h,updateIsGrid:()=>u.value=!u.value,updateCtx:(i,s)=>{h[i]=s}}}),P=k();function X(){class u{constructor(t){this.canvas=t,this.ctx=t.value.getContext("2d"),this.pathStore=[],this.type="stroke",this.path=new Path2D,this.contextOptions=null}init(t){this.startPoint=t,this.lastPoint=t,this.ctx.moveTo(t.x,t.y)}line(t,e){this.ctx.beginPath(),this.path=new Path2D,this.path.moveTo(this.lastPoint.x,this.lastPoint.y),this.path.lineTo(t,e),this.type="stroke",this.draw(),this.ctx.closePath(),this.lastPoint={x:t,y:e}}arc(t,e){this.path=new Path2D;const i=t-this.startPoint.x,s=e-this.startPoint.y,o=this.startPoint.x+i/2,a=this.startPoint.y+s/2,d=Math.pow(i*i+s*s,1/2);this.path.arc(o,a,d/2,0,Math.PI*2),this.type="stroke",this.draw()}rect(t,e){this.path=new Path2D;const i=t-this.startPoint.x,s=e-this.startPoint.y;this.path.rect(this.startPoint.x,this.startPoint.y,i,s),this.type="stroke",this.draw()}getMarkSize(t){const e=t/4;switch(!0){case t<100:return{w:1,h:e<2?2:e,incline:2,size:e<2?2:e/2};default:return{w:4,h:20,incline:4,size:10}}}mark(t,e){this.ctx.save(),this.path=new Path2D;const i=t-this.startPoint.x,s=e-this.startPoint.y,o=i<0?-1:1,a=Math.pow(i*i+s*s,1/2)*o;let d=Math.asin(Math.sin(s/a));this.setContextOptions({translate:{x:this.startPoint.x,y:this.startPoint.y},rotate:d});const n=this.getMarkSize(Math.abs(a));this.path.lineTo(0,0),this.path.lineTo(0,-n.w/2),this.path.lineTo(a-n.h*o,-n.size),this.path.lineTo(a-n.h*o-n.incline*o,-n.size*2),this.path.lineTo(a,0),this.path.lineTo(a-n.h*o-n.incline*o,n.size*2),this.path.lineTo(a-n.h*o,n.size),this.path.lineTo(0,n.w/2),this.path.lineTo(0,0),this.type="fill",this.draw(),this.ctx.restore()}text(t,e,i){const o=document.createElement("textarea");o.cols=1,o.rows=1,this.setContextOptions({font:"32px auto",textBaseline:"middle"}),o.oninput=a=>{this.clearCanvas(),this.pathStore.forEach(({type:d,contextOptions:n,path:r})=>{r.text?this.ctx.fillText(r.text,r.x,r.y):(this.type=d,this.contextOptions=n,this.path=r,this.draw(!0)),this.contextOptions=null}),o.cols=a.target.value.length+1,this.ctx.fillText(a.target.value,t+2,e)},o.onblur=a=>{this.type="fill",this.path={x:t+2,y:e,text:a.target.value},a.target.value&&this.savePath(),o.parentNode.removeChild(o)},o.style.cssText=`
        overflow: hidden;
        position: absolute;
        top: ${e-32/2}px;
        left: ${t}px;
        height: 32px;
        line-height: 32px;
        background-color: transparent;
        outline: none;
        resize: none;
        border: 1px solid #000;
        font-size: 32px;
        white-space: pre-wrap;
        text-indent: 2px;
        color: transparent;
        caret-color: #000;
      `,i.value.appendChild(o)}clear(t,e){this.ctx.save(),this.path=new Path2D,this.setContextOptions({lineWidth:20,lineCap:"round",globalCompositeOperation:"destination-out"}),this.path.moveTo(this.lastPoint.x,this.lastPoint.y),this.path.lineTo(t,e),this.type="stroke",this.draw(),this.lastPoint={x:t,y:e},this.ctx.restore()}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.value.width,this.canvas.value.height)}setContextOptions(t){for(let e in t){if(e==="translate"){this.ctx[e](t[e].x,t[e].y);continue}if(e==="rotate"){this.ctx[e](t[e]);continue}this.ctx[e]=t[e]}this.contextOptions={...this.contextOptions,...t}}draw(t){this.ctx.save(),this.ctx.beginPath(),t?this.setContextOptions(this.contextOptions):this.setContextOptions({strokeStyle:P.ctx.color,fillStyle:P.ctx.color,lineWidth:P.ctx.lineWidth}),this.type==="stroke"?this.ctx.stroke(this.path):this.ctx.fill(this.path),this.ctx.closePath(),this.ctx.restore()}savePath(){this.pathStore.push({type:this.type,contextOptions:this.contextOptions||{},path:this.path}),this.contextOptions=null,this.type="stroke"}}return{Draw:u}}const Y=["max"],j={class:"item"},R=["onClick"],U={__name:"actionBar",props:{handleDownload:{type:Function,required:!0}},setup(u){const h=u,t=k(),e=x(null),i=x(50),s=z([{icon:"icon-juxing1",type:"rect"},{icon:"icon-yuanxingweixuanzhong",type:"arc"},{icon:"icon-jiantou_youshang",type:"mark"},{icon:"icon-Icon_huabi",type:"line"},{icon:"icon-wenzi",type:"text"},{icon:"icon-rubber-full",type:"clear"},{icon:"icon-xiazai-",type:"download"}]),o=b(()=>e.value?getComputedStyle(e.value).height:0),a=(d,n)=>{if(n==="download")return h.handleDownload();t.updateCtx(d,n)};return(d,n)=>(f(),g("aside",{class:"aside",ref_key:"aside",ref:e},[C(w("input",{class:"line-width",type:"range","onUpdate:modelValue":n[0]||(n[0]=r=>c(t).ctx.lineWidth=r),max:i.value,style:S({width:o.value,"background-image":`linear-gradient(to right, #91caff ${c(t).ctx.lineWidth/i.value*100+"%"}, transparent ${c(t).ctx.lineWidth/100*100+"%"})`}),onChange:n[1]||(n[1]=r=>a("lineWidth",r.target.value))},null,44,Y),[[T,c(t).ctx.lineWidth]]),w("div",{class:_(["item iconfont icon-wangge",{"hide-grid":!c(t).isGrid}]),onClick:n[2]||(n[2]=(...r)=>c(t).updateIsGrid&&c(t).updateIsGrid(...r))},null,2),w("div",j,[C(w("input",{class:"color",type:"color","onUpdate:modelValue":n[3]||(n[3]=r=>c(t).ctx.color=r),onChange:n[4]||(n[4]=r=>a("color",r.target.value))},null,544),[[T,c(t).ctx.color]])]),(f(!0),g(L,null,W(s,r=>(f(),g("div",{class:_(["item iconfont",[r.icon,c(t).ctx.mode===r.type?"active":""]]),key:r.type,onClick:$(v=>a("mode",r.type),["stop"])},null,10,R))),128))],512))}};const N={__name:"drawingBoard",setup(u){const h=k(),{Draw:t}=X(),e=x(),i=x();let s=null;const o=()=>{const{clientWidth:p,clientHeight:l}=document.documentElement;i.value.width=p,i.value.height=l},a=x(!1),d=()=>{const p=i.value.toDataURL(),l=document.createElement("a");l.setAttribute("href",p),l.setAttribute("download",Math.random().toString(16).slice(-6)),l.click()},n=p=>{a.value=!0;const{clientX:l,clientY:y}=p;s.init({x:l,y}),h.ctx.mode==="text"&&(a.value=!1,s.text(l,y,e))},r=p=>{if(!a.value)return;const{clientX:l,clientY:y}=p;s.clearCanvas(),["line","clear"].includes(h.ctx.mode)&&s.savePath(),s.pathStore.forEach(({type:D,contextOptions:E,path:m})=>{m.text?s.ctx.fillText(m.text,m.x,m.y):(s.type=D,s.contextOptions=E,s.path=m,s.draw(!0)),s.contextOptions=null}),s[h.ctx.mode](l,y)},v=()=>{a.value=!1,s.savePath()},O=()=>{i.value.addEventListener("mousedown",n),i.value.addEventListener("mousemove",r),i.value.addEventListener("onmouseleave",v),i.value.addEventListener("mouseup",v)};return B(()=>{o(),O(),window.addEventListener("resize",o),s=new t(i)}),G(()=>{i.value.removeEventListener("mousedown",n),i.value.removeEventListener("mousemove",r),i.value.removeEventListener("onmouseleave",v),i.value.removeEventListener("mouseup",v),window.removeEventListener("resize",o)}),(p,l)=>(f(),g("main",{ref_key:"canvasRoot",ref:e},[w("canvas",{ref_key:"cDom",ref:i,class:_(["canvas",{"show-grid":c(h).isGrid}])},null,2),I(U,{handleDownload:d})],512))}};export{N as default};
